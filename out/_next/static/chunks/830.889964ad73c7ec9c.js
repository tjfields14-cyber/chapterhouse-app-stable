(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[830],{2848:function(e){function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=function(){return[]},t.resolve=t,t.id=2848,e.exports=t},9188:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return r}});var a=n(5893),s=n(7294),o=n(9814);function r(){let[e,t]=s.useState(!1),[n,r]=s.useState(""),[i,l]=s.useState(""),[c,d]=s.useState(""),[u,p]=s.useState(""),[h,f]=s.useState([]),g=s.useRef(null);async function x(){try{g.current=(0,o.s)(i,c),localStorage.setItem("ch_supabase_url",i),localStorage.setItem("ch_supabase_anon",c),r(i.replace(/^https?:\/\//,"").split(".")[0])}catch(e){alert(e.message||String(e))}}async function y(){let e=u.trim();if(!e)return;if(/[A-Za-z0-9_\-]{40,}/.test(e)||/(sk-|ghp_|gho_|AIzaSy|AKIA|EAACEdEose0cBA|xoxp-|xoxb-|slack)/i.test(e)){alert("That looks like a secret/token. Blocked.");return}p("");let t=new Date().toISOString();f(n=>[{role:"user",content:e,ts:t},...n]);let n=g.current||(0,o.s)(i,c),a=e.replace(/[A-Za-z0-9_\-]{40,}/g,"•••redacted•••"),s="Trey here—got you. ".concat(a);try{await n.from("bff_notes").insert([{content:"user: ".concat(a)}]),await n.from("bff_notes").insert([{content:"trey: ".concat(s)}]),f(e=>[{role:"assistant",content:s,ts:new Date().toISOString()},...e])}catch(e){alert(e.message||String(e))}}return s.useEffect(()=>{let e=localStorage.getItem("ch_supabase_url")||"",t=localStorage.getItem("ch_supabase_anon")||"";if(e&&t){l(e),d(t);try{g.current=(0,o.s)(e,t),r(e.replace(/^https?:\/\//,"").split(".")[0])}catch(e){}}},[]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>t(e=>!e),style:{position:"fixed",right:18,bottom:18,zIndex:2147483647,width:64,height:64,borderRadius:999,border:"0",background:"#111",color:"#fff",boxShadow:"0 8px 24px rgba(0,0,0,.25)"},"aria-label":"Open Chapterhouse Assistant",children:"CH"}),e&&(0,a.jsxs)("div",{style:{position:"fixed",right:18,bottom:96,width:480,height:620,background:"#fff",borderRadius:16,boxShadow:"0 16px 48px rgba(0,0,0,.25)",overflow:"hidden",display:"flex",flexDirection:"column",zIndex:2147483647},children:[(0,a.jsxs)("div",{style:{padding:"12px 16px",background:"#0a0a0a",color:"#fff",fontWeight:600},children:["Chapterhouse Assistant ",n&&(0,a.jsxs)("span",{style:{opacity:.7},children:["(connected to ",n,")"]})]}),(0,a.jsxs)("div",{style:{padding:12,display:"grid",gap:8,borderBottom:"1px solid #eee"},children:[(0,a.jsx)("input",{placeholder:"Supabase URL",value:i,onChange:e=>l(e.target.value)}),(0,a.jsx)("input",{placeholder:"Supabase anon key",value:c,onChange:e=>d(e.target.value)}),(0,a.jsx)("button",{onClick:x,style:{padding:"8px 10px"},children:"Connect"})]}),(0,a.jsxs)("div",{style:{flex:"1 1 auto",padding:12,overflow:"auto",background:"#fafafa"},children:[0===h.length&&(0,a.jsx)("div",{style:{opacity:.6},children:"No messages yet."}),h.map((e,t)=>(0,a.jsxs)("div",{style:{marginBottom:8},children:[(0,a.jsx)("div",{style:{fontSize:12,opacity:.5},children:new Date(e.ts).toLocaleString()}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("b",{children:["user"===e.role?"you":"trey",":"]})," ",e.content]})]},t))]}),(0,a.jsxs)("div",{style:{display:"flex",gap:8,padding:12,borderTop:"1px solid #eee"},children:[(0,a.jsx)("input",{placeholder:"Type a message",value:u,onChange:e=>p(e.target.value),style:{flex:"1 1 auto"},onKeyDown:e=>{"Enter"===e.key&&y()}}),(0,a.jsx)("button",{onClick:y,style:{padding:"8px 10px"},children:"Send"})]})]})]})}},9814:function(e,t,n){"use strict";n.d(t,{s:function(){return r}});var a=n(1608),s=n(3454);let o=null;function r(e,t){let n=(e||s.env.NEXT_PUBLIC_SUPABASE_URL||"").trim(),r=(t||s.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"").trim();if(!n||!r)throw Error("Missing Supabase env vars. Set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY.");return o||(o=(0,a.eI)(n,r,{auth:{persistSession:!1,storageKey:"chapterhouse_widget"}})),o}}}]);